---
title: "Mendota_P_int_all"
author: "Lauren A. Knose, ORISE-EPA"
date: '2023-06-22'
output: html_document
editor_options: 
  chunk_output_type: console
---

The purpose of this program is to calculate the internal P loading for Lake
Mendota, WI. 

# Step 1. Load dependent packages and data needed:

a) loading dependent packages...

```{r}
library(ggplot2) #needed for plots
library(dplyr) #needed for reformaing data
```

Packages loaded.

b) loading dependent data...

```{r}
waterP<- read.csv(file="Cleaned_data/Mendota_P_water.csv") 
water<- read.csv(file="Cleaned_data/Mendota_P_volume.csv")
```

_____the following code needs to be adapted from the ext P loading program_____


# Step 3. Summarize and view data:

a) plot total P load for CyanoHAB season by source for each year...
```{r}
int_all<- Me_all %>%
  select(sampledate, Yr, daynum, HE_ratio_TotP_mgL) %>%
  summarize(mean=mean(HE_ratio_TotP_mgL, na.rm=TRUE),
            se=(sd(HE_ratio_TotP_mgL, na.rm=TRUE)/sqrt(length(HE_ratio_TotP_mgL))),
            min=min(HE_ratio_TotP_mgL, na.rm=TRUE),
            max=max(HE_ratio_TotP_mgL, na.rm=TRUE)
            ) #calculate annual total P load
int_all

int_sumtot<- Me_all %>%
  select(sampledate, Yr, daynum, HE_ratio_TotP_mgL) %>%
  group_by(Yr) %>% #for every year
  summarize(mean=mean(HE_ratio_TotP_mgL, na.rm=TRUE),
            se=(sd(HE_ratio_TotP_mgL, na.rm=TRUE)/sqrt(length(HE_ratio_TotP_mgL))),
            min=min(HE_ratio_TotP_mgL, na.rm=TRUE),
            max=max(HE_ratio_TotP_mgL, na.rm=TRUE)
            ) #calculate annual total P load
int_sumtot



ggplot(extP_load_sumtot, aes(x=as.factor(Yr), y=sum_TP_kgyr, 
                             fill=Source)) + #separate sources by fill color
  geom_bar(position="stack", stat="identity", color="black") + #stacked bar graph
  scale_fill_manual(values=c("grey", "black")) + #atm = grey, streams=black
  theme_classic(base_size=12) +
  labs(x="Year", y="Total P loading (kg/yr)") 
```

Total P load by source for each year plotted.

b) calculate average daily total P load for CyanoHAB season...

```{r}
extP_load_dayavg<- extP_load %>%
  filter(Source=="total") %>% #for the total external P load
  summarize(mean=mean(TotP_kgday, na.rm=TRUE), #calculate mean
            se=(sd(TotP_kgday, na.rm=TRUE)/sqrt(length(TotP_kgday))),
            min=min(TotP_kgday, na.rm=TRUE),
            max=max(TotP_kgday, na.rm=TRUE)
            )
extP_load_dayavg
```

b) calculating average annual total P load for CyanoHAB season...

```{r}
extP_load_yravg<- extP_load %>%
  filter(Source=="total") %>% #for the total external P load
  group_by(Yr) %>%
  summarize(sum=sum(TotP_kgday))
extP_load_yravg
```

The average annual total P load was `r mean(extP_load_yravg$sum)` +- 
`r (sd(extP_load_yravg$sum)/sqrt(length(extP_load_yravg$sum)))` kg/yr. 
