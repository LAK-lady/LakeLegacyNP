---
title: "TotalP_external_all.Rmd"
author: "Lauren A. Knose, ORISE-EPA"
date: '2024-05-07'
output: html_document
editor_options: 
  chunk_output_type: console
---

The purpose of this program is to calculate total external P load from both atmospheric deposition and stream inflows.

# Step 1. Load dependent packages and data needed:

a) Loading dependent packages...

```{r}
library(ggplot2) #needed for plots
library(dplyr) #needed for reformaing data
library(reshape2) #needed for reshaping data frames from wide to long
```

Packages loaded.

b) Loading dependent data....

```{r}
SWAT_totP<- read.csv(file="Original_data/HarshaLake_SWAT_loads_2000to2018.csv") 
```

Data loaded.

# Step 2. Define, filter, and merge data:

```{r}
### identify the labels used for fields ###
colnames(SWAT_totP) #identify labels for fields to filter
head(SWAT_totP$Date) #determine format for sample date

extload<- SWAT_totP %>%
  mutate(sampledate=as.Date(Date, format="%m/%d/%Y",origin="1899-12-30"),
         Yr=as.numeric(format(sampledate, "%Y")), #renames field
         daynum=as.numeric(format(sampledate, "%j"))) %>%#reformat date
  filter(daynum>=(152-7) & daynum<=(258+7), #filter for cyanoHAB season
         Yr=="2015"|Yr=="2017"|Yr=="2018"|Yr=="2019") %>% #filter for years
  select(sampledate, Yr, daynum, TOTN_kg_All, TOTP_kg_All)
```

Data defined

# Step 3. Summarize and view data:

```{r}
### summarize by year ###
extload_sum<- extload %>%
  group_by(Yr) %>%
  summarize(Yr_totN_kgyr=sum(TOTN_kg_All, na.rm=TRUE),
            meanTN_kgday=mean(TOTN_kg_All, na.rm=TRUE),
            se_TN_kgday=(sd(TOTN_kg_All, na.rm=TRUE)/sqrt(length(TOTN_kg_All))),
            Yr_totP_kgyr=sum(TOTP_kg_All, na.rm=TRUE),
            meanTP_kgday=mean(TOTP_kg_All, na.rm=TRUE),
            se_TP_kgday=(sd(TOTP_kg_All, na.rm=TRUE)/sqrt(length(TOTP_kg_All))))
extload_sum
```

Annual and daily average total P and total N from external loading calculated.

# Step 4. Save data as new data file:

```{r}
write.csv(extload, file="Cleaned_data/TotalP_allext.csv")
```

New data file created with total external P loading.